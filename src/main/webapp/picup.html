<!DOCTYPE html>
<html>
<meta charset="UTF-8">
    <body>
        <button id="create-button" >Create Container</button>

        <input type="file" id="fileinput" multiple/>
        <button id="upload-button">Upload</button>

        <button id="list-button">List</button>
        
        <button id="delete-button" hidden=hidden>Delete</button>
        <button id="download-button" onclick="downloadImg()">Down</button>
    </body>
    <script src="/js/azure-storage.blob.min.js" charset="utf-8"></script>
    <script>
    
    let downloadlink=new Array(5).fill(0);//[0,0,0,0,0]
        const account = {
    name: "dlsg2te1",
    sas: "?sv=2019-02-02&ss=bfqt&srt=sco&sp=rwdlacup&se=2020-07-30T15:58:10Z&st=2019-11-06T07:58:10Z&spr=https&sig=xF0KNlkHAzMKu7deJMd9CyM8j9OhW9UJW8KRgE8rjdU%3D"
};

const blobUri = 'https://' + account.name + '.blob.core.windows.net';
const blobService = AzureStorage.Blob.createBlobServiceWithSas(blobUri, account.sas);
/*document.getElementById('create-button').addEventListener('click', () => {

    blobService.createContainerIfNotExists('mycontainer',  (error, container) => {
        if (error) {
            // Handle create container error
        } else {
            console.log(container.name);
        }
    });
    54667894153475616

});*/
document.getElementById('upload-button').addEventListener('click', () =>{
    var len=document.getElementById('fileinput').files.length;
	for(i=0;i<len;i++){
    var file = document.getElementById('fileinput').files[i];

    blobService.createBlockBlobFromBrowserFile('modelblob1', 
                                                file.name, 
                                                file, 
                                                (error, result) => {
                                                    if(error) {
                                                        // Handle blob error
                                                    } else {
                                                        console.log('Upload is successful');
                                                    }
                                                });

	}});
document.getElementById('list-button').addEventListener('click', () => {

    blobService.listBlobsSegmented('modelblob1', null, (error, results) => {
        if (error) {
            // Handle list blobs error
        } else {
            results.entries.forEach(blob => {
                console.log(blob.name);
            });
        }
    });
    
});

 function downloadImg(){
        
	                var downloadLink = blobService.getUrl('myblob1', 'timg.jpg');
	                console.log(downloadLink);
                    let url =downloadLink;               
                    let a = document.createElement("a");          // 创建一个a节点插入的document
                    let event = new MouseEvent("click");           // 模拟鼠标click点击事件
                    a.download = 'tepic';                  // 设置a节点的download属性值
                    a.href = url;                                 // 将图片的src赋值给a节点的href
                    a.dispatchEvent(event)  ;                      // 触发鼠标点击事件
                 }

           
    
    

/*document.getElementById('delete-button').addEventListener('click', () => {

    var blobName = YOUR_BLOB_NAME;
    blobService.deleteBlobIfExists('mycontainer', blobName, (error, result) => {
        if (error) {
            // Handle delete blob error
        } else {
            console.log('Blob deleted successfully');
        }
    });
    
});*/
    </script>
</html>

